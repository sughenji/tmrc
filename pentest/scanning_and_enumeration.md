# Scanning and enumeration

- [LAN](#lan)
- [NMAP](#nmap)
- [Nikto](#nikto)
- [HTTP directory enumeration](#http-directory-enumeration)
- [SAMBA](#samba)
- [SSH](#ssh)
- [Masscan](#masscan)
- [scanning with metasploit](#scanning-with-metasploit)
- [NFS](#nfs)
- [Skipfish](#skipfish)

## LAN

Very basic Kali tools:

```
arp-scan -l
netdiscover -r 192.168.0.0/24
```

## NMAP

Simple host/port discovery (TCP)

```
nmap -iL host_list.txt -T4 -Pn -n -p- -oA scan_output
```

Simple host/port discovery (UDP)

```
nmap -T4 -Pn -n -sU -p- -oA scan_output 192.168.88.242
```

Some tips:

```
-ddd (for intense debug)
--max-retries 0 (if you are pretty confident on your network
```

Default scripts:

```
# grep categories /usr/share/nmap/scripts/*.nse |grep default | awk -F: '{ print $1 }' | sed -e 's/\/usr\/share\/nmap\/scripts\///g'
address-info.nse
afp-serverinfo.nse
ajp-auth.nse
ajp-methods.nse
amqp-info.nse
auth-owners.nse
backorifice-info.nse
bitcoinrpc-info.nse
cassandra-info.nse
clock-skew.nse
creds-summary.nse
dicom-ping.nse
dns-nsid.nse
dns-recursion.nse
dns-service-discovery.nse
epmd-info.nse
finger.nse
flume-master-info.nse
freelancer-info.nse
ftp-anon.nse
ftp-bounce.nse
ftp-syst.nse
ganglia-info.nse
giop-info.nse
gopher-ls.nse
hadoop-datanode-info.nse
hadoop-jobtracker-info.nse
hadoop-namenode-info.nse
hadoop-secondary-namenode-info.nse
hadoop-tasktracker-info.nse
hbase-master-info.nse
hbase-region-info.nse
hddtemp-info.nse
http-auth.nse
http-cisco-anyconnect.nse
http-cookie-flags.nse
http-cors.nse
http-default-accounts.nse
http-default-accounts.nse
http-default-accounts.nse
http-favicon.nse
http-generator.nse
http-git.nse
http-ls.nse
http-methods.nse
http-ntlm-info.nse
http-open-proxy.nse
http-robots.txt.nse
http-svn-enum.nse
http-svn-info.nse
http-title.nse
ike-version.nse
imap-capabilities.nse
imap-ntlm-info.nse
ip-https-discover.nse
ipv6-node-info.nse
irc-info.nse
iscsi-info.nse
jdwp-info.nse
knx-gateway-info.nse
maxdb-info.nse
mongodb-databases.nse
mongodb-info.nse
ms-sql-info.nse
ms-sql-ntlm-info.nse
mysql-info.nse
nat-pmp-info.nse
nbstat.nse
ncp-serverinfo.nse
netbus-info.nse
nntp-ntlm-info.nse
ntp-info.nse
openlookup-info.nse
p2p-conficker.nse
pop3-capabilities.nse
pop3-ntlm-info.nse
quake1-info.nse
quake3-info.nse
quake3-master-getservers.nse
rdp-ntlm-info.nse
rmi-dumpregistry.nse
rpcinfo.nse
rtsp-methods.nse
servicetags.nse
sip-methods.nse
smb2-security-mode.nse
smb2-time.nse
smb-os-discovery.nse
smb-security-mode.nse
smtp-commands.nse
smtp-ntlm-info.nse
snmp-hh3c-logins.nse
snmp-info.nse
snmp-interfaces.nse
snmp-netstat.nse
snmp-processes.nse
snmp-sysdescr.nse
snmp-win32-services.nse
snmp-win32-shares.nse
snmp-win32-software.nse
snmp-win32-users.nse
socks-auth-info.nse
socks-open-proxy.nse
ssh-hostkey.nse
sshv1.nse
ssl-cert.nse
ssl-date.nse
ssl-known-key.nse
sslv2.nse
sstp-discover.nse
telnet-ntlm-info.nse
tls-alpn.nse
tls-nextprotoneg.nse
ubiquiti-discovery.nse
upnp-info.nse
uptime-agent-info.nse
ventrilo-info.nse
vnc-info.nse
wdb-version.nse
weblogic-t3-info.nse
wsdd-discover.nse
x11-access.nse
xmlrpc-methods.nse
xmpp-info.nse
```

To only select "safe" scripts:

```
nmap -Pn -p445 10.10.10.40 --script "safe"
```

Or:

```
nmap -Pn -p445 10.10.10.40 --script "safe and vuln"
```

## Nikto

```
nikto -h http://10.31.14.5
```

To skip directory busting:

```
nikto -h hostname -ssl -Plugin "@@DEFAULT;-dir_traversal" -Display V
```

To search for obsolete version:

```
nikto -h hostname -ssl -Plugin outdated -Display V
```

HTML output:

```
nikto -h hostname -o report.htm -Display V
```

## HTTP directory enumeration

### dirbuster

Target URL: http://1.1.1.1:80

Number of Threads: check "Go Faster"

File with list of dir/files: directory-list-2.3-small.txt ...

File extension: php,zip,bak

![dirbuster](https://user-images.githubusercontent.com/42389836/148435892-74d20987-682e-4e8c-9ea9-259e55d842c5.png)

### dirb

```
dirb https://hostname /usr/share/wordlists/dirb/common.txt
```

### gobuster

Installation:

```
wget https://golang.org/dl/go1.16.5.linux-amd64.tar.gz
rm -rf /usr/local/go && tar -C /usr/local -xzf go1.16.5.linux-amd64.tar.gz
export PATH=$PATH:/usr/local/go/bin
```

To check "go":

```
# go version
go version go1.16.5 linux/amd64
```

Install gobuster:

```
go install github.com/OJ/gobuster/v3@latest
```

Run:

```
gobuster dir -u http://hostname -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -o filename
```

Other usage:

```
gobuster dir -k -u https://10.10.10.60:443 -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt -x php,html,txt -o output
```

### dirsearch

https://github.com/maurosoria/dirsearch

```
python3 dirsearch.py -h http://10.10.... -e php,html -x 400,401,403
```

## SAMBA

### metasploit

```
====================================================
# msfconsole
msf5> use scanner/smb/smb_version

set RHOSTS 192.168.1.0/24
run
====================================================
```

### smbclient

```
# smbclient -L \\\\hostname\\

# smbclient \\\\hostname\sharename
Enter WORKGROUP\root's password:
Try "help" to get a list of possible commands.
smb: \> ls

# smbclient -U 'guest' -L 10.10.10.180
# smbclient -U '' -L 10.10.10.180
# smbclient -U '.' -L 10.10.10.180
```

### enum4linux

### crackmapexec

```
# crackmapexec smb 10.10.10.180 --shares
SMB         10.10.10.180    445    REMOTE           [*] Windows 10.0 Build 17763 x64 (name:REMOTE) (domain:remote) (signing:False) (SMBv1:False)
SMB         10.10.10.180    445    REMOTE           [-] Error enumerating shares: Error occurs while reading from remote(104)
```

### smbmap

```
smbmap -u whatever -H 10.10.10.134
```

## SSH

```
nmap -sV --script "ssh* and safe" -p $PORT $HOST -oN $NAME
```

cipher issues:

```
root@kali:~/tcm/kioptrix# ssh 10.31.14.5
Unable to negotiate with 10.31.14.5 port 22: no matching key exchange method found. Their offer: diffie-hellman-group-exchange-sha1,diffie-hellman-group1-sha1

root@kali:~/tcm/kioptrix# ssh 10.31.14.5 -oKexAlgorithms=+diffie-hellman-group1-sha1
Unable to negotiate with 10.31.14.5 port 22: no matching cipher found. Their offer: aes128-cbc,3des-cbc,blowfish-cbc,cast128-cbc,arcfour,aes192-cbc,aes256-cbc,rijndael128-cbc,rijndael192-cbc,rijndael256-cbc,rijndael-cbc@lysator.liu.se

root@kali:~/tcm/kioptrix# ssh 10.31.14.5 -oKexAlgorithms=+diffie-hellman-group1-sha1 -c aes128-cbc
The authenticity of host '10.31.14.5 (10.31.14.5)' can't be established.
RSA key fingerprint is SHA256:VDo/h/SG4A6H+WPH3LsQqw1jwjyseGYq9nLeRWPCY/A.
Are you sure you want to continue connecting (yes/no/[fingerprint])?
```

## masscan

```
masscan -p1-65535 --rate 1000 host
```

## scanning with metasploit

```
msf5 > use scanner/portscan/syn
msf5 auxiliary(scanner/portscan/syn) > options

Module options (auxiliary/scanner/portscan/syn):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   BATCHSIZE  256              yes       The number of hosts to scan per set
   DELAY      0                yes       The delay between connections, per thread, in milliseconds
   INTERFACE                   no        The name of the interface
   JITTER     0                yes       The delay jitter factor (maximum value by which to +/- DELAY) in milliseconds.
   PORTS      1-10000          yes       Ports to scan (e.g. 22-25,80,110-900)
   RHOSTS                      yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   SNAPLEN    65535            yes       The number of bytes to capture
   THREADS    1                yes       The number of concurrent threads (max one per host)
   TIMEOUT    500              yes       The reply read timeout in milliseconds

msf5 auxiliary(scanner/portscan/syn) > set THREADS 100
THREADS => 100
msf5 auxiliary(scanner/portscan/syn) > set ports 1-65535
ports => 1-65535
msf5 auxiliary(scanner/portscan/syn) > set rhosts 1.1.1.1
rhosts => 1.1.1.1
msf5 auxiliary(scanner/portscan/syn) > run
```

## NFS

```
nmap -p 111 --script=nfs-ls,nfs-statfs,nfs-showmount 1.1.1.1
PORT    STATE SERVICE
111/tcp open  rpcbind
| nfs-ls: Volume /var
|   access: Read Lookup NoModify NoExtend NoDelete NoExecute
| PERMISSION  UID  GID  SIZE  TIME                 FILENAME
| rwxr-xr-x   0    0    4096  2019-09-04T08:53:24  .
| rwxr-xr-x   0    0    4096  2019-09-04T12:27:33  ..
| rwxr-xr-x   0    0    4096  2019-09-04T12:09:49  backups
| rwxr-xr-x   0    0    4096  2019-09-04T10:37:44  cache
| rwxrwxrwt   0    0    4096  2019-09-04T08:43:56  crash
| rwxrwsr-x   0    50   4096  2016-04-12T20:14:23  local
| rwxrwxrwx   0    0    9     2019-09-04T08:41:33  lock
| rwxrwxr-x   0    108  4096  2019-09-04T10:37:44  log
| rwxr-xr-x   0    0    4096  2019-01-29T23:27:41  snap
| rwxr-xr-x   0    0    4096  2019-09-04T08:53:24  www
|_
| nfs-showmount:
|_  /var *
| nfs-statfs:
|   Filesystem  1K-blocks  Used       Available  Use%  Maxfilesize  Maxlink
|_  /var        9204224.0  1836536.0  6877092.0  22%   16.0T        32000
```

```
# mount -t nfs 10.10.104.17:/var /mnt/nfs/
```

other usage:

```
# showmount -e 10.10.10.180
Export list for 10.10.10.180:
/site_backups (everyone)
```

## Skipfish

```
skipfish -o nowasp http://192.168.106.253/mutillidae
```


