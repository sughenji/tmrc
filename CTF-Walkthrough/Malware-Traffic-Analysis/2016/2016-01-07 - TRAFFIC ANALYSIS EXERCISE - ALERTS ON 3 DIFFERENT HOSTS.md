https://www.malware-traffic-analysis.net/2016/01/07/index.html

- Date and time range of the traffic you're reviewing.

from 2016-01-07 22:05:47 to 2016-01-07 22:17:18

- IP address, MAC address, and host name for each of the 3 computers in the pcap.

we can start with Wireshark's filter: `dhcp.option.hostname `

this is an useful `tshark` onliner:

```bash
$ tshark -r 2016-01-07-traffic-analysis-exercise.pcap -Y "dhcp && dhcp.type == 1 && dhcp.option.dhcp == 3" -T fields -e eth.src  -e bootp.option.hostname -e dhcp.option.requested_ip_address | uniq
00:22:19:e2:4b:86       FULL-METAL-JACK 192.168.122.130
00:26:55:32:a9:17       Jennifer-PC     192.168.122.52
48:5b:39:c1:f2:48       Hokaydoo-PC     192.168.122.132
```


- Description of the activity for each of the 3 computers (what happened, if the host became infected, any details, etc.).

# export http objects

first of all, we can extract all files in `/objects` folder:

```bash
tshark -r 2016-01-07-traffic-analysis-exercise.pcap --export-objects http,objects
```

# planetside.co.uk

by looking for HTTP traffic, the first *unusual* domain seems `planetside.co.uk` (`67.225.139.108`)  
traffic to this website seems legit  
on file `2016-01-07-traffic-analysis-exercise-snort-events.txt` we get some match with description "SDF Combination Alert", "Classification: Senstive Data"  

there is just a POST request that seems unharmful


# Hokaydoo-PC (192.168.122.132)

## stream 207

at 2016-01-07 22:10:08, host `Hokaydoo-PC` made a Google search and reach website `www.koeppl.com`

## stream 208

we notice an odd Javascript code:

![](_attachment/Pasted%20image%2020250116105232.png)

we look for string `kjpxhkghapgcgt` in our previously downloaded objects:

```bash
$ grep -rl kjpxhkghapgcgt *
%2f(2)
```

We was unable to deobfuscate that code.

## stream 221

on that stream, we notice a connection to website `uacltr.securetopc.top` (`referer: http://www.koeppl.com/`), from here the workstation downloaded a flash file

```http
GET /1993/10/14/madness/willow/dick-sort-southward-swallow.html HTTP/1.1
Accept: text/html, application/xhtml+xml, */*
Referer: http://www.koeppl.com/
Accept-Language: en-US
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko
Accept-Encoding: gzip, deflate
Host: uacltr.securetopc.top
```

## stream 222

```
GET /1987/09/28/behave/cheerful-stumble-broad.html.swf HTTP/1.1
```

we found this file in exported objects

```bash
$ file * | grep -i flash
cheerful-stumble-broad.html.swf:                                                                                                                                                                                                                                 Macromedia Flash data (compressed), version 18
```

![](_attachment/Pasted%20image%2020250115181401.png)

## stream 324

![](_attachment/Pasted%20image%2020250116114957.png)

if we look at HTML page we see this:

![](_attachment/Pasted%20image%2020250116115040.png)





# FULL-METAL-JACK (192.168.122.130)
## stream 254

in stream 254 we notice a download of an EXE file from workstation `FULL-METAL-JACK`

![](_attachment/Pasted%20image%2020250115155033.png)

this file is being downloaded from Host: dariostoka.com (174.36.186.235)

The provided alerts also confirm this suspicious download:

```bash
[**] [1:15306:22] FILE-EXECUTABLE Portable Executable binary file magic detected [**]
[Classification: Potential Corporate Privacy Violation] [Priority: 1]
01/07-23:12:04.612428 174.36.186.235:80 -> 192.168.122.130:49223
TCP TTL:116 TOS:0x0 ID:19247 IpLen:20 DgmLen:1407 DF
***A**** Seq: 0xD7C6152D  Ack: 0x9957AF5C  Win: 0xFE4F  TcpLen: 20

[**] [1:15306:22] FILE-EXECUTABLE Portable Executable binary file magic detected [**]
[Classification: Potential Corporate Privacy Violation] [Priority: 1]
01/07-23:12:04.612428 174.36.186.235:80 -> 192.168.122.130:49223
TCP TTL:116 TOS:0x0 ID:19247 IpLen:20 DgmLen:1407 DF
***A**** Seq: 0xD7C6152D  Ack: 0x9957AF5C  Win: 0xFE4F  TcpLen: 20

[**] [1:25061:7] FILE-EXECUTABLE Microsoft Software Installer MSI binary file magic detected [**]
[Classification: Potential Corporate Privacy Violation] [Priority: 1]
01/07-23:12:04.612428 174.36.186.235:80 -> 192.168.122.130:49223
TCP TTL:128 TOS:0x0 ID:2808 IpLen:20 DgmLen:16444 DF
***A**** Seq: 0xD7C6152D  Ack: 0x9957AF5C  Win: 0x0  TcpLen: 20

[**] [139:1:1] (spp_sdf) SDF Combination Alert [**]
[Classification: Senstive Data] [Priority: 2]
01/07-23:12:09.973674 174.36.186.235 -> 192.168.122.130
PROTO:254 TTL:128 TOS:0x0 ID:2830 IpLen:20 DgmLen:84 DF

```

we can extract from Wireshark:

![](_attachment/Pasted%20image%2020250115164449.png)

according to VT, file has a high score:

https://www.virustotal.com/gui/file/95a9c8fccbe0e49dc132cf59d7ebf73e692da9f35491e0bfcac40b92c9022f5c/details

![](_attachment/Pasted%20image%2020250115164610.png)


just before the DNS query for `dariostoka.com`, we notice:

![](_attachment/Pasted%20image%2020250115164952.png)

from that host, workstation 192.168.122.130 download another executable file:

![](_attachment/Pasted%20image%2020250115165104.png)

...it's the same file (md5sum: `9f756e72eacc6b805481a49ce51c4a79`)




# Host Jennifer-PC (192.168.122.52)

## stream 119

Connection to `st.domandvilma.com` (referer: Referer: http://planetside.co.uk/)

```http
GET /fvviewforumqn.php HTTP/1.1
Accept: application/javascript, */*;q=0.8
Referer: http://planetside.co.uk/
Accept-Language: en-US
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)
Accept-Encoding: gzip, deflate
Host: st.domandvilma.com
Connection: Keep-Alive

HTTP/1.1 200 OK

Server: nginx/1.8.0
Date: Thu, 07 Jan 2016 22:09:22 GMT
Content-Type: text/javascript; charset=ISO-8859-1
Transfer-Encoding: chunked
Connection: keep-alive
P3P: policyref="/w3c/p3p.xml", CP="policyref="/html/p3p.xml", CP="NON DSP COR NID DEVa PSAa PSDa OUR BUS""
Set-Cookie: fltna=XZobADIAAgAOABLijlb__xLijlZAAAEAAAAS4o5WAA--; expires=Fri, 06-Jan-2017 22:09:22 GMT; path=/; domain=st.domandvilma.com
Content-Encoding: gzip

var main_color_handle='';
```

- A conclusion with recommendations for any follow-up actions.

## other solutions

https://www.herbiez.com/?p=324

